<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="iris-ticket-caller">
  <template>
    <style>
      :host {
        display: block;
        font-size: 72px;
        width: 100%;
      }
      
      iron-icon {
        width: 60px;
        height: 60px;
        background-color: var(--mydoc-brown-400);
        border-radius: 50%;
        color: white;
        margin-right: 20px;
      }
      
      .labels > div {
        display: flex;
        flex-direction: row;
        align-items: center;
      }
      
      .labels > div > span {
        display: flex;
        align-items: center;
        margin-right: 20px;
      }
      
      span.label-text {
        width: 250px;
      }
      
      .client {
        margin-bottom: 30px;
      }
    </style>

    <iris-roomdisplay id="roomdisplay" ticket-to-play="{{ticket}}"></iris-roomdisplay>
    <audio id="audio" src="{{ src }}" on-loadeddata="onCanPlay" on-ended="onMediaEnd"></audio>
    <div class="labels">

      <div class="client">
        <iron-icon icon="icons:chevron-right"></iron-icon>
        <span class="label-text">Клиент</span>
        <span>[[current.label]]</span>
      </div>
      <div class="operator">
        <iron-icon icon="icons:chevron-right"></iron-icon>
        <span class="label-text">Окно</span>
        <span>[[current.operator.short_label]]</span>
      </div>
    </div>

  </template>
  <script>
    'use strict'
    Polymer({
      is: 'iris-ticket-caller',
      properties: {
        ticket: {
          type: Object,
          observer: 'ticketUpdate'
        },
        isPlaying: {
          type: Boolean
        }
      },
      ticketUpdate(ticket) {
        if (!ticket) return;
        console.log(ticket.id, ticket.order);
        this.current = ticket;
        this.src = ticket.voice;
        if (this.$.audio.readyState == 4) this.play();
      },
      onMediaEnd() {
        if (this.ticket) this.$.roomdisplay.played(this.ticket).then(() => {
          console.log('played!');
          this.set('isPlaying', false);
        });

      },
      onCanPlay() {
        this.play();
      },
      play() {
        this.$.audio.play();
        this.set('isPlaying', true);
      },
      call(to_play) {
        let ticket = to_play.ticket;
        let sound = to_play.sound;

      }
    });
  </script>
</dom-module>